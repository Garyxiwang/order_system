<!--pages/order-detail/order-detail.wxml-->
<view class="order-detail-container" wx:if="{{ orderDetail }}">
  <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
  <van-cell-group title="ğŸ“‹ è®¢å•ä¿¡æ¯">
    <van-cell
      title="è®¢å•ç¼–å·"
      value="{{ orderDetail.order_number }}"
      is-link
      bind:click="copyText"
      data-text="{{ orderDetail.order_number }}"
      custom-class="order-number-cell"
    />
    <van-cell title="è®¢å•çŠ¶æ€">
      <van-tag
        slot="value"
        type="primary"
        size="medium"
        custom-style="background: linear-gradient(135deg, {{ orderDetail.statusColor }} 0%, {{ orderDetail.statusColor }}dd 100%); border: none; color: #fff; font-weight: 500; padding: 8rpx 20rpx; border-radius: 20rpx;"
      >
        {{ orderDetail.order_status }}
      </van-tag>
    </van-cell>
    <van-cell title="å®¢æˆ·åç§°" value="{{ orderDetail.customer_name }}" />
    <van-cell title="åœ°å€" value="{{ orderDetail.address }}" />
    <van-cell title="è®¢å•ç±»å‹" value="{{ orderDetail.order_type }}" />
    <van-cell
      wx:if="{{ orderDetail.category_name }}"
      title="ç±»ç›®åç§°"
      value="{{ orderDetail.category_name }}"
    />
  </van-cell-group>

  <!-- äººå‘˜ä¿¡æ¯ -->
  <van-cell-group title="ğŸ‘¥ äººå‘˜ä¿¡æ¯">
    <van-cell
      wx:if="{{ orderDetail.designer }}"
      title="è®¾è®¡å¸ˆ"
      value="{{ orderDetail.designer }}"
    />
    <van-cell
      wx:if="{{ orderDetail.salesperson }}"
      title="é”€å”®å‘˜"
      value="{{ orderDetail.salesperson }}"
    />
  </van-cell-group>

  <!-- æ—¥æœŸä¿¡æ¯ -->
  <van-cell-group title="ğŸ“… æ—¥æœŸä¿¡æ¯">
    <van-cell title="åˆ†å•æ—¥æœŸ" value="{{ formatDate(orderDetail.assignment_date) }}" />
    <van-cell
      wx:if="{{ orderDetail.order_date }}"
      title="ä¸‹å•æ—¥æœŸ"
      value="{{ formatDate(orderDetail.order_date) }}"
    />
    <van-cell
      wx:if="{{ orderDetail.design_cycle }}"
      title="è®¾è®¡å‘¨æœŸ"
      value="{{ orderDetail.design_cycle }}å¤©"
    />
    <van-cell
      title="åˆ›å»ºæ—¶é—´"
      value="{{ formatDateTime(orderDetail.created_at) }}"
    />
    <van-cell
      title="æ›´æ–°æ—¶é—´"
      value="{{ formatDateTime(orderDetail.updated_at) }}"
    />
  </van-cell-group>

  <!-- é¢ç§¯å’Œé‡‘é¢ -->
  <van-cell-group title="ğŸ’° é¢ç§¯å’Œé‡‘é¢">
    <van-cell
      wx:if="{{ orderDetail.cabinet_area }}"
      title="æŸœä½“é¢ç§¯"
      value="{{ orderDetail.cabinet_area }}ã¡"
    />
    <van-cell
      wx:if="{{ orderDetail.wall_panel_area }}"
      title="å¢™æ¿é¢ç§¯"
      value="{{ orderDetail.wall_panel_area }}ã¡"
    />
    <van-cell
      wx:if="{{ orderDetail.order_amount }}"
      title="è®¢å•é‡‘é¢"
      value="{{ formatAmount(orderDetail.order_amount) }}"
      custom-class="amount-cell"
    />
    <van-cell wx:if="{{ orderDetail.is_installation }}" title="æ˜¯å¦å®‰è£…">
      <van-tag slot="value" type="success" size="medium">å«å®‰è£…</van-tag>
    </van-cell>
  </van-cell-group>

  <!-- å¤‡æ³¨ä¿¡æ¯ -->
  <van-cell-group wx:if="{{ orderDetail.remarks }}" title="ğŸ“ å¤‡æ³¨">
    <view class="remarks-content">
      {{ orderDetail.remarks }}
    </view>
  </van-cell-group>

  <!-- è¿›åº¦ä¿¡æ¯ -->
  <van-cell-group
    wx:if="{{ orderDetail.progresses && orderDetail.progresses.length > 0 }}"
    title="ğŸ“Š è¿›åº¦ä¿¡æ¯"
  >
    <view
      wx:for="{{ orderDetail.progresses }}"
      wx:key="id"
      class="progress-item"
    >
      <view class="progress-header">
        <text class="progress-task">{{ item.task_item }}</text>
        <van-tag
          wx:if="{{ item.status }}"
          type="primary"
          size="small"
          custom-style="margin-left: 16rpx;"
        >
          {{ item.status }}
        </van-tag>
      </view>
      <view class="progress-details" wx:if="{{ item.planned_date || item.actual_date || item.assignee }}">
        <view class="detail-item" wx:if="{{ item.planned_date }}">
          <text class="detail-icon">ğŸ“…</text>
          <text class="detail-text">è®¡åˆ’æ—¥æœŸï¼š{{ item.planned_date }}</text>
        </view>
        <view class="detail-item" wx:if="{{ item.actual_date }}">
          <text class="detail-icon">âœ…</text>
          <text class="detail-text">å®é™…æ—¥æœŸï¼š{{ item.actual_date }}</text>
        </view>
        <view class="detail-item" wx:if="{{ item.assignee }}">
          <text class="detail-icon">ğŸ‘¤</text>
          <text class="detail-text">è´Ÿè´£äººï¼š{{ item.assignee }}</text>
        </view>
      </view>
      <view class="progress-remarks" wx:if="{{ item.remarks }}">
        <van-cell title="å¤‡æ³¨" value="{{ item.remarks }}" />
      </view>
      <van-divider wx:if="{{ index < orderDetail.progresses.length - 1 }}" />
    </view>
  </van-cell-group>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading" wx:if="{{ loading }}">
  <van-loading type="spinner" size="24px" color="#1989fa">åŠ è½½ä¸­...</van-loading>
</view>

<!-- é”™è¯¯çŠ¶æ€ -->
<van-empty
  wx:if="{{ !loading && !orderDetail }}"
  description="åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"
  image="error"
  custom-class="error-state"
/>
